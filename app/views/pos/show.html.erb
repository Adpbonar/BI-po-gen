<div>
  <h1>PO <%= @po.po_number %>: <%= @po.title %></h1>
  <%= render 'nav', po: @po %>
  <p style="text-transform: uppercase;"><b>Status: <%= @po.status %></b></p>
  <p>Service: <%= @po.service_type %></p>
  <p>Approximate completion time: <%= @po.duration %><br />
    <small class="highlight">From <%= read_date(@po.start_date) %> to <%= read_date(@po.end_date) %></small></p>
  <p>PO <%=sanitize @po.issued_by %></p>
  <% if @po.description.present? %>
    <div class="top-bottom-spacing">
      <p><b>Description</b></p>
      <%= @po.description %>
    </div>
  <% end %>
  <div>
    <div class="top-bottom-spacing change">
      <h2>Po Participants</h2>
      <div class="top-bottom-spacing">
        <p><span class="bold">Learning coordinator:</span> <%= @po.show_coordinator %></p>
        <p><span class="bold">PO initiator:</span> <%= @po.show_found %></p>
      </div>
      <% @po_users.group_by(&:type_of).each do |type_of, users| %>
        <div>
          <h3><%= type_of %>s</h3>
          <% users.each do |user| %>
            <div>
              <span class="upcase"><%= user.participant.name.split(".").last %> (<%= type_of %>)</span>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
  <h2>Installments</h2>
  <% if @po.installments.count == @po.number_of_installments %>
    <div class="upcase">Number of installments: <%= @po.number_of_installments %>
      (<%= @po.show_installments_total_percent %>) | PO client currency: <%= show_currency(@po) %> | PO value:
      <%= @po.currency.html_safe.to_s + number_to_currency(@po.statements.first.subtotal).split("$").last %></div>
  <% end %>
  <table style="width: 100%; margin: 1em;">
    <tbody>
      <tr>
        <td colspan="2" style="vertical-align: middle;">
          <div style="margin: 5px; padding: 5px; background-color: #e8e8e8e8; border: 1px dotted green;">
            <%= render 'change', po: @po %>
          </div>
        </td>
      </tr>
      <tr>
        <td style="width: 30%">
          <% @po.installments.order([:id]).each_with_index do |installment, index| %>
            <% if installment.due_date.present? %>
              <div class="top-bottom-spacing">Installment <%= index + 1 %>: <span
            class="highlight"><%= read_date(installment.due_date) %></span> @ <%= installment.percentage %>%</div>
              <div><%= link_to 'Change due date', edit_installment_path(installment), class: 'btn btn-info' %></div>
            <% else %>
              <div class="top-bottom-spacing">Installment <%= index + 1 %>:
                <%= link_to 'No Due Date set for installment', edit_installment_path(installment), class: 'btn btn-info' %> @
                <%= installment.percentage %>%</div>
            <% end %>
          <% end %>
        </td>
        <td style="vertical-align: top;">
          <div data-reflex-permanent>
            <div id="loadingChart" class="center"></div>
            <div id="installmentChart">
              <%= pie_chart @pdf_chart_data, donut: true, legend: true, title: "Installment Percentages"  %>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  <h2>Statements</h2>
  <ul>
    <% @po.statements.order(:type).reverse_order.each do |statement|%>
      <% unless statement.no_general %>
        <% if statement.type == 'GeneralStatement' %>
          <% unless statement.achieved %>
            <li><%= link_to "edit statement".capitalize, statement_url(statement), class: 'default-link' %></li>
          <% end %>
        <% else %>
          <li><%= link_to ass_type(statement).to_s + " " + statement.type.underscore.titleize.capitalize + ": " + statement.participant_name.split(".").last, statement_url(statement), class: 'default-link' %></li>
        <% end %>
      <% end %>
    <% end %>
  </ul>
  <%= render 'populate', po: @po %>
  <%= render 'nav', po: @po %>
</div>
